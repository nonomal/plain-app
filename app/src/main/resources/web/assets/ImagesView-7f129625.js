import{d as ke,ad as ye,p as we,r as m,u as $e,s as Ie,a as Te,A as Ve,n as Ce,B as Se,C as xe,ae as Re,af as Ae,D as Ee,t as ze,ag as Fe,ah as Me,G as W,H as Ue,I as qe,o as n,c,b as e,e as f,w as b,Q as T,k as d,f as l,v as Be,J as F,K as De,L as Ne,g as o,F as V,y as M,l as X,M as j,N as Le,x as Qe,ab as J,ai as P,z as Y,R as Z,a6 as Ge,aj as Ke,ak as He,al as Oe,_ as We}from"./index-79f9263f.js";import{u as Xe,_ as je,a as Je}from"./list-5e8cf700.js";import{_ as Pe}from"./FieldId-d1ec1c14.js";import{_ as Ye}from"./Multiselect-6b10a69c.js";import{_ as Ze}from"./Dropdown.vuevuetypescriptsetuptruelang-19bba1a4.js";import{_ as et,a as tt}from"./grid-view-outline-rounded-11c22744.js";import{_ as st}from"./Breadcrumb-754c867d.js";import{n as ee}from"./list-6498ebd9.js";import{b as ot,a as at}from"./search-52423e6c.js";import{u as nt,a as lt,b as it}from"./tags-1ae8d7cb.js";import{u as ct,_ as ut}from"./ConfirmModal.vuevuetypescriptsetuptruelang-d45efc91.js";import"./VModal.vuevuetypescriptsetuptruelang-3158168b.js";import"./baseIndexOf-70b929c6.js";import"./vee-validate.esm-496cb60b.js";const te=k=>(He("data-v-821e0d44"),k=k(),Oe(),k),dt={class:"v-toolbar"},rt={class:"right-actions"},_t=["onClick"],pt=["onClick"],mt={class:"row mb-3"},gt={class:"col-md-3 col-form-label"},ht={class:"col-md-9"},vt=["onKeyup"],ft={class:"row mb-3"},bt={class:"col-md-3 col-form-label"},kt={class:"col-md-9"},yt={class:"actions"},wt=["onClick"],$t={key:0,class:"row row-cols-6 g-1",style:{"margin-bottom":"24px"}},It=["onClick"],Tt=["src"],Vt={class:"duration"},Ct={key:1,class:"table"},St=te(()=>e("th",null,"ID",-1)),xt=te(()=>e("th",null,null,-1)),Rt=["onClick"],At=["onUpdate:modelValue"],Et=["src","onClick"],zt={class:"badge"},Ft={key:0},Mt={colspan:"6"},Ut={class:"no-data-placeholder"},qt={key:2,class:"no-data-placeholder"},Bt=ke({__name:"ImagesView",setup(k){var K,H,O;const se=ye(),U=we(),u=m([]),{t:g}=$e(),{app:C}=Ie(Te()),r=Ve({text:"",tags:[]}),h="IMAGE",S=Ce().query,v=m(parseInt(((K=S.page)==null?void 0:K.toString())??"1")),y=54,w=m(0),_=m(Se(((H=S.q)==null?void 0:H.toString())??"")),q=m(""),{tags:x}=nt(h,_,r,async s=>{q.value=ot(s),await xe(),de()}),i=m(((O=S.view)==null?void 0:O.toString())??"grid"),{visible:oe,index:ae,view:B,hide:ne}=Re(),{addToTags:le}=lt(h,u,x),{removeFromTags:ie}=it(h,u,x),{deleteItems:ce}=ct(h,u),R=Ae(()=>u.value.map(s=>({src:J(s.fileId),name:P(s.path),duration:0,size:s.size}))),ue=[{text:g("add_to_tags"),click:le},{text:g("remove_from_tags"),click:ie},{text:g("delete"),click:ce}],{selectAll:A,toggleSelect:D}=Xe(u),{loading:N,load:de,refetch:re}=Ee({handle:async(s,a)=>{if(a)ze(g(a),"error");else if(s){const{fileIdToken:E}=C.value,$=[];for(const I of s.images)$.push({...I,checked:!1,fileId:await Fe(E,I.path)});u.value=$,w.value=s.imageCount}},document:Me,variables:()=>({offset:(v.value-1)*y,limit:y,query:q.value}),appApi:!0});function L(){Y(U,`/images?page=${v.value}&q=${Z(_.value)}&view=${i.value}`)}W(v,()=>{L()}),W(i,()=>{L()});function Q(){_.value=at(r),G()}function G(){Y(U,`/images?q=${Z(_.value)}&view=${i.value}`)}function _e(){i.value==="grid"?i.value="list":i.value="grid"}function pe(){se.push("/files"),Ge(ut,{message:g("upload_images")})}return Ue(()=>{qe.on("refetch_by_tag_type",s=>{s===h&&re()})}),(s,a)=>{const E=st,$=et,I=tt,me=Ze,ge=Ye,he=je,ve=Pe,fe=Je,be=Ke;return n(),c(V,null,[e("div",dt,[f(E,{current:()=>`${s.$t("page_title.images")} (${w.value})`},null,8,["current"]),e("div",rt,[e("button",{type:"button",class:"btn btn-action",onClick:b(_e,["stop"])},[i.value==="list"?(n(),T($,{key:0,class:"bi"})):d("",!0),i.value==="grid"?(n(),T(I,{key:1,class:"bi"})):d("",!0)],8,_t),e("button",{type:"button",class:"btn btn-action",onClick:b(pe,["stop"])},l(s.$t("upload")),9,pt),i.value==="list"?(n(),T(me,{key:0,title:s.$t("actions"),items:ue},null,8,["title"])):d("",!0),f(he,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=t=>_.value=t),search:G},{filters:Be(()=>[e("div",mt,[e("label",gt,l(s.$t("keywords")),1),e("div",ht,[F(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>r.text=t),class:"form-control",onKeyup:Ne(Q,["enter"])},null,40,vt),[[De,r.text]])])]),e("div",ft,[e("label",bt,l(s.$t("tags")),1),e("div",kt,[f(ge,{modelValue:r.tags,"onUpdate:modelValue":a[1]||(a[1]=t=>r.tags=t),label:"name","track-by":"id",options:o(x)},null,8,["modelValue","options"])])]),e("div",yt,[e("button",{type:"button",class:"btn",onClick:b(Q,["stop"])},l(s.$t("search")),9,wt)])]),_:1},8,["modelValue"])])]),i.value==="grid"?(n(),c("div",$t,[(n(!0),c(V,null,M(o(R),(t,z)=>(n(),c("div",{class:"col",onClick:p=>o(B)(z)},[e("img",{class:"image",src:t.src+"&w=200&h=200"},null,8,Tt),e("span",Vt,l(o(X)(t.size)),1)],8,It))),256))])):d("",!0),i.value==="list"?(n(),c("table",Ct,[e("thead",null,[e("tr",null,[e("th",null,[F(e("input",{class:"form-check-input",type:"checkbox",onChange:a[3]||(a[3]=(...t)=>o(D)&&o(D)(...t)),"onUpdate:modelValue":a[4]||(a[4]=t=>Le(A)?A.value=t:null)},null,544),[[j,o(A)]])]),St,xt,e("th",null,l(s.$t("name")),1),e("th",null,l(s.$t("tags")),1),e("th",null,l(s.$t("file_size")),1)])]),e("tbody",null,[(n(!0),c(V,null,M(u.value,(t,z)=>(n(),c("tr",{key:t.id,class:Qe({checked:t.checked}),onClick:b(p=>t.checked=!t.checked,["stop"])},[e("td",null,[F(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":p=>t.checked=p},null,8,At),[[j,t.checked]])]),e("td",null,[f(ve,{id:t.id,raw:t},null,8,["id","raw"])]),e("td",null,[e("img",{src:o(J)(t.fileId)+"&w=200&h=200",width:"50",height:"50",onClick:b(p=>o(B)(z),["stop"])},null,8,Et)]),e("td",null,l(o(P)(t.path)),1),e("td",null,[(n(!0),c(V,null,M(t.tags,p=>(n(),c("span",zt,l(p.name),1))),256))]),e("td",null,l(o(X)(t.size)),1)],10,Rt))),128))]),u.value.length?d("",!0):(n(),c("tfoot",Ft,[e("tr",null,[e("td",Mt,[e("div",Ut,l(s.$t(o(ee)(o(N),o(C).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])):d("",!0),i.value==="grid"&&o(R).length===0?(n(),c("div",qt,l(s.$t(o(ee)(o(N),o(C).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):d("",!0),w.value>y?(n(),T(fe,{key:3,modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=t=>v.value=t),total:w.value,limit:y},null,8,["modelValue","total"])):d("",!0),f(be,{visible:o(oe),index:o(ae),sources:o(R),onHide:o(ne)},null,8,["visible","index","sources","onHide"])],64)}}});const es=We(Bt,[["__scopeId","data-v-821e0d44"]]);export{es as default};
