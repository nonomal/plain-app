import{aW as B,r,U as b,aX as E,aY as I,ag as x,aZ as G,i as P,a_ as V,u as S,t as F,aU as T,aT as M,a$ as k,b0 as L,aw as C,R,b1 as U,b2 as _,s as $,a as H,b3 as W,b4 as Q,aV as j}from"./index-79f9263f.js";import{b as z}from"./search-52423e6c.js";import{b as N}from"./baseIndexOf-70b929c6.js";import{a as O}from"./toInteger-d7cff406.js";var X=Math.max;function Y(s,o,e){var a=s==null?0:s.length;if(!a)return-1;var t=e==null?0:O(e);return t<0&&(t=X(a+t,0)),N(s,B(o),t)}const ee=(s,o)=>{const e=r("");return{createPath:e,createVariables(a){return{path:e.value+"/"+a}},createMutation(){return b({document:E,options:{update:async(a,t)=>{const{fileIdToken:n}=s.value;for(const u of o.value)if(u.dir===e.value){const i=t.data.createDir;u.items.push({...i,name:I(i.path),fileId:await x(n,i.path)})}}},appApi:!0})}}},ae=s=>{const o=r(""),e=r("");return{renameValue:o,renamePath:e,renameDone(a){const t=e.value,n=o.value;for(const u of s.value)u.rename(t,n,a)},renameMutation(){return b({document:G,appApi:!0})},renameVariables(a){return{path:e.value,name:a}}}},te=(s,o,e)=>({onDeleted(a){for(const t of s.value)t.deleteItem(a.path);if(o.value.startsWith(a.path)){const t=a.path.lastIndexOf("/");o.value=a.path.substring(0,t)}e()}}),se=()=>{const s=r(0),o=r(0),{refetch:e}=P({handle:(a,t)=>{t||(s.value=a.storageStats.totalBytes,o.value=a.storageStats.freeBytes)},document:V,appApi:!0});return{totalBytes:s,freeBytes:o,refetch:e}},ne=(s,o)=>{const e=r(""),a=r(""),t=r(""),n=r([]),{t:u}=S();let i=0;const{loading:w}=P({handle:async(v,h)=>{if(h)F(u(h),"error");else{const{dir:f,items:m}=v.files;t.value===""&&(e.value=f);const{fileIdToken:g}=s.value,d=[];for(const l of m){const p={...l,name:I(l.path)};(T(p.name)||M(p.name))&&(p.fileId=await x(g,l.path)),d.push(p)}const c=f.replace(e.value,"").split("/").length;for(;n.value.length>=c;)n.value.pop();if(n.value.push(new k(f,d)),o){const l=o.replace(e.value+"/","").split("/");d.length===0?i=l.length-1:i<l.length&&(t.value=e.value+"/"+l.slice(0,i+1).join("/"),i++)}}},document:L,variables:{dir:t,showHidden:!0},options:{fetchPolicy:"no-cache"},appApi:!0}),{refetch:D}=P({handle:async(v,h)=>{if(h)F(u(h),"error");else{const{dir:f,items:m}=v.files,{fileIdToken:g}=s.value,d=[];for(const c of m)d.push({...c,name:I(c.path),fileId:await x(g,c.path)});n.value.forEach(c=>{c.dir===f&&(c.items=d)})}a.value=""},document:L,variables:{dir:a,showHidden:!0},options:()=>({fetchPolicy:"no-cache",enabled:!!a.value}),appApi:!0});return{loading:w,panels:n,refetch(v){a.value=v,D()},rootDir:e,currentDir:t}},oe=s=>({async download(o,e){const{fileIdToken:a}=s.value,t=await W(a,o);e?Q(t+`&dl=1&name=${e}`,e):Q(t+"&dl=1",I(o))}}),le=(s,o)=>({view(e,a){s.value=e.items.filter(n=>M(n.name)||T(n.name)||j(n.name)).map(n=>({path:n.path,src:"",name:I(n.path)}));const t=Y(s.value,n=>n.path===a.path);o(t)}}),ue=(s,o,e)=>{const a=r(null);return{selectedItem:a,select(t,n){n.isDir?s.value=n.path:t.items.some(i=>i.path===s.value)&&t.items.some(i=>i.path===n.path)&&(s.value=t.dir);const u=[];u.push({name:"path",op:"",value:n.path}),u.push({name:"dir",op:"",value:s.value}),o.value=z(u),a.value=n,C(e,`/files?q=${R(o.value)}`)}}},ie=(s,o)=>{const e=r(null),a=r(null),t=r(!1),n=r(),{mutate:u,loading:i,onDone:w,onError:D}=b({document:U,appApi:!0}),{mutate:v,loading:h,onDone:f,onError:m}=b({document:_,appApi:!0}),{t:g}=S(),d=l=>{F(g(l.message))};D(d),m(d);const c=()=>{var l;if(t.value){const p=a.value.items.findIndex(y=>y.path===e.value.path);(l=a.value)==null||l.items.splice(p,1)}e.value=null,setTimeout(()=>{s(n.value),o()},500)};return w(c),f(c),{loading:i||h,canPaste(){return!!e.value},copy(l){e.value=l,t.value=!1},cut(l,p){e.value=p,a.value=l,t.value=!0},paste(l){var y,A;n.value=l;const p={src:(y=e.value)==null?void 0:y.path,dst:l+"/"+((A=e.value)==null?void 0:A.name),overwrite:!1};t.value?v(p):u(p)}}},re=()=>{const{uploads:s}=$(H()),o=r(""),e=r();return{input:e,upload(a){o.value=a,e.value.value="",e.value.click()},uploadChanged(a){const t=a.target.files;if(!t)return;const n=[];for(let u=0;u<t.length;u++){const i=t[u];n.push({dir:o.value,file:i,status:"created",uploadedSize:0,error:""})}s.value=[...s.value,...n]}}};export{ne as a,ee as b,ae as c,se as d,ue as e,ie as f,re as g,te as h,le as i,oe as u};
