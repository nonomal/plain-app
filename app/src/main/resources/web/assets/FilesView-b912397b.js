import{o as i,c as u,b as c,d as ne,U as Te,Y as Fe,a1 as Se,Q as V,v as x,g as t,f as m,u as qe,r as C,n as Ie,B as Be,p as He,s as X,a as Pe,ae as Re,G as Ne,H as Ae,I as Ee,e as I,J as Ue,M as ze,N as We,F as D,y as J,x as je,k as p,aT as K,aU as Y,ab as Le,j as w,P as Ze,l as B,X as H,aj as Ge,aV as Oe,_ as Qe}from"./index-79f9263f.js";import{_ as Xe}from"./Breadcrumb-754c867d.js";import{c as ee}from"./index-e18fef4c.js";import{g as te,M as Je}from"./splitpanes.es-c29164c5.js";import{n as Ke}from"./list-6498ebd9.js";import{a as Ye,b as et,c as tt,d as st,e as nt,f as at,g as ot,h as it,u as lt,i as ct}from"./files-ded7ae0f.js";import{_ as rt}from"./VModal.vuevuetypescriptsetuptruelang-3158168b.js";import{_ as se}from"./EditValueModal.vuevuetypescriptsetuptruelang-bf52f959.js";import{c as ut}from"./search-52423e6c.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-d7cff406.js";import"./vee-validate.esm-496cb60b.js";const dt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},mt=c("path",{fill:"currentColor",d:"M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.588 1.413T20 20H4ZM4 6v12h16V8h-8.825l-2-2H4Zm0 0v12V6Z"},null,-1),pt=[mt];function _t(v,s){return i(),u("svg",dt,pt)}const ht={name:"material-symbols-folder-outline-rounded",render:_t},ft=["disabled"],vt=ne({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},file:{type:Object,required:!0}},setup(v){const s=v,{mutate:b,loading:P,onDone:$}=Te({document:Fe`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function k(){b({paths:[s.file.path]})}return $(()=>{s.onDone(s.file),Se()}),(_,h)=>{const M=rt;return i(),V(M,{class:"delete-modal",title:_.$t("confirm_to_delete_name",{name:v.file.name})},{action:x(()=>[c("button",{type:"button",disabled:t(P),class:"btn",onClick:k},m(_.$t("delete")),9,ft)]),_:1},8,["title"])}}}),bt={class:"page-container container"},kt={class:"main"},yt={class:"v-toolbar"},gt={class:"right-actions"},Ct={class:"form-check mt-2"},Dt={class:"form-check-label",for:"show-hidden"},wt={class:"file-items"},Vt=["onClick","onDblclick","onContextmenu"],xt=["src"],$t={class:"title"},Mt={style:{"font-size":"0.75rem"}},Tt=["onContextmenu"],Ft={key:0,class:"no-files"},St={key:0,class:"file-item-info"},qt=ne({__name:"FilesView",setup(v){var Z,G,O;const{t:s}=qe(),b=C([]),$=Ie().query,k=C(Be(((Z=$.q)==null?void 0:Z.toString())??"")),_=ut(k.value),h=C(((G=_.find(e=>e.name==="path"))==null?void 0:G.value)??""),M=C(((O=_.find(e=>e.name==="dir"))==null?void 0:O.value)??""),R=He(),{app:y}=X(Pe()),{loading:ae,panels:d,currentDir:T,refetch:N}=Ye(y,M.value),{visible:oe,index:ie,view:le,hide:ce}=Re(),{createPath:re,createVariables:ue,createMutation:de}=et(y,d),{renameValue:me,renamePath:pe,renameDone:_e,renameMutation:he,renameVariables:fe}=tt(d),{totalBytes:ve,freeBytes:be,refetch:F}=st(),{onDeleted:ke}=it(d,T,F),{download:A}=lt(y),{view:E}=ct(b,le),{selectedItem:g,select:ye}=nt(T,k,R),{canPaste:U,copy:z,cut:ge,paste:S}=at(N,F),{input:Ce,upload:W,uploadChanged:j}=ot(),{fileShowHidden:f}=X(R);h.value&&Ne(()=>d.value.length,()=>{if(d.value.length>0&&h.value){const n=d.value[d.value.length-1].items.find(a=>a.path===h.value);n&&(g.value=n,h.value="")}});function De(){return`${s("page_title.files")} (${s("storage_free_total",{free:B(be.value),total:B(ve.value)})})`}function we(e,n){ye(e,n)}function L(e){return K(e.name)||Y(e.name)||Oe(e.name)}function Ve(e,n){n.isDir||(L(n)?E(e,n):A(n.path))}function xe(e,n){e.preventDefault();const a=[{label:s("create_folder"),onClick:()=>{re.value=n,H(se,{title:s("name"),placeholder:s("name"),mutation:de,getVariables:ue})}},{label:s("upload_files"),onClick:()=>{W(n)}}];U()&&a.push({label:s("paste"),onClick:()=>{S(n)}}),ee({x:e.x,y:e.y,items:a})}function $e(e,n,a){e.preventDefault();let l;a.isDir?l=[{label:s("upload_files"),onClick:()=>{W(a.path)}}]:(l=[],L(a)&&l.push({label:s("open"),onClick:()=>{E(n,a)}}),l.push({label:s("download"),onClick:()=>{A(a.path)}})),l.push({label:s("duplicate"),onClick:()=>{z(a),S(n.dir)}}),l.push({label:s("cut"),onClick:()=>{ge(n,a)}}),l.push({label:s("copy"),onClick:()=>{z(a)}}),a.isDir&&U()&&l.push({label:s("paste"),onClick:()=>{S(a.path)}}),l=[...l,{label:s("rename"),onClick:()=>{me.value=a.name,pe.value=a.path,H(se,{title:s("rename"),placeholder:s("name"),value:a.name,mutation:he,getVariables:fe,done:_e})}},{label:s("delete"),onClick:()=>{H(vt,{file:a,onDone:ke})}}],ee({x:e.x,y:e.y,items:l})}return Ae(()=>{Ee.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{N(e.dir),F()},1e3)})}),(e,n)=>{const a=Xe,l=ht,Me=Ge;return i(),u("div",bt,[c("div",kt,[c("div",yt,[I(a,{current:De}),c("div",gt,[c("div",Ct,[Ue(c("input",{class:"form-check-input","onUpdate:modelValue":n[0]||(n[0]=r=>We(f)?f.value=r:null),id:"show-hidden",type:"checkbox"},null,512),[[ze,t(f)]]),c("label",Dt,m(e.$t("show_hidden")),1)])])]),I(t(Je),{class:"panel-container"},{default:x(()=>[(i(!0),u(D,null,J(t(d),r=>(i(),V(t(te),{key:r.dir},{default:x(()=>[c("div",wt,[(i(!0),u(D,null,J(r.items,o=>{var Q;return i(),u(D,{key:o.path},[!o.name.startsWith(".")||t(f)?(i(),u("div",{key:0,class:je(["file-item",{active:(t(T)+"/").startsWith(o.path+"/")||((Q=t(g))==null?void 0:Q.path)===o.path}]),onClick:q=>we(r,o),onDblclick:q=>Ve(r,o),onContextmenu:q=>$e(q,r,o)},[o.isDir?(i(),V(l,{key:0,class:"bi"})):p("",!0),t(K)(o.name)||t(Y)(o.name)?(i(),u("img",{key:1,src:t(Le)(o.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,xt)):p("",!0),c("div",$t,[w(m(o.name)+" ",1),c("div",Mt,[w(m(t(Ze)(o.updatedAt)),1),o.isDir?p("",!0):(i(),u(D,{key:0},[w(", "+m(t(B)(o.size)),1)],64))])])],42,Vt)):p("",!0)],64)}),128)),c("div",{class:"empty",onContextmenu:o=>xe(o,r.dir)},[r.items.filter(o=>!o.name.startsWith(".")||t(f)).length===0?(i(),u("div",Ft,m(e.$t("no_files")),1)):p("",!0)],40,Tt)])]),_:2},1024))),128)),t(d).length===0?(i(),V(t(te),{key:0,class:"no-data-placeholder"},{default:x(()=>[w(m(e.$t(t(Ke)(t(ae),t(y).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):p("",!0)]),_:1}),t(g)?(i(),u("div",St,m(e.$t("path"))+": "+m(t(g).path),1)):p("",!0),I(Me,{visible:t(oe),index:t(ie),sources:b.value,onHide:t(ce)},null,8,["visible","index","sources","onHide"]),c("input",{ref_key:"fileInput",ref:Ce,style:{display:"none"},type:"file",multiple:"",onChange:n[1]||(n[1]=(...r)=>t(j)&&t(j)(...r))},null,544)])])}}});const Lt=Qe(qt,[["__scopeId","data-v-52fdf4eb"]]);export{Lt as default};
