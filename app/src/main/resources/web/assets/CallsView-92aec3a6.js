import{b as ut,u as rt,_ as dt,a as pt}from"./list-5e8cf700.js";import{_ as mt}from"./call-outline-rounded-3b1ba7b9.js";import{_ as _t}from"./FieldId-d1ec1c14.js";import{l as ht,_ as ft}from"./Multiselect-6b10a69c.js";import{_ as vt}from"./Dropdown.vuevuetypescriptsetuptruelang-19bba1a4.js";import{_ as gt}from"./Breadcrumb-754c867d.js";import{d as yt,p as bt,s as $t,a as kt,r as m,u as Ct,A as Vt,n as Tt,B as wt,C as St,S as At,D as Dt,t as Lt,T as qt,G as It,H as Mt,I as Ut,U as xt,V as Bt,o as n,c as r,b as e,e as h,v as Qt,f as a,J as S,K as Gt,L as Nt,g as l,w as $,M as N,N as Rt,F as A,y as R,x as Ft,j as Kt,Q as F,W as zt,O as Et,P as jt,k as K,z as k,R as C,X as Ot,Y as Pt}from"./index-79f9263f.js";import{n as Ht}from"./list-6498ebd9.js";import{_ as Jt}from"./DeleteConfirm.vuevuetypescriptsetuptruelang-7b95bd7d.js";import{b as z}from"./search-52423e6c.js";import{u as Wt,a as Xt,b as Yt}from"./tags-1ae8d7cb.js";import"./VModal.vuevuetypescriptsetuptruelang-3158168b.js";import"./baseIndexOf-70b929c6.js";import"./vee-validate.esm-496cb60b.js";const Zt={class:"v-toolbar"},te={class:"right-actions"},ee={class:"row mb-3"},se={class:"col-md-3 col-form-label"},oe={class:"col-md-9"},ae=["onKeyup"],le={class:"row mb-3"},ne={class:"col-md-3 col-form-label"},ce={class:"col-md-9"},ie={class:"actions"},ue=["onClick"],re={class:"table"},de=e("th",null,"ID",-1),pe={class:"actions one"},me=["onClick"],_e=["onUpdate:modelValue"],he={key:0,class:"spinner spinner-sm"},fe={class:"nowrap"},ve={class:"badge"},ge=["title"],ye={class:"actions one"},be=["onClick"],$e={key:0},ke={colspan:"10"},Ce={class:"no-data-placeholder"},Ne=yt({__name:"CallsView",setup(Ve){var Q,G;const f=bt(),{app:E}=$t(kt()),u=m([]),{t:_}=Ct(),c=Vt({text:"",tags:[]}),v="CALL",D=Tt(),L=D.query,g=m(parseInt(((Q=L.page)==null?void 0:Q.toString())??"1")),y=50,b=m(0),i=m(wt(((G=L.q)==null?void 0:G.toString())??"")),q=m(""),{tags:V}=Wt(v,i,c,async t=>{d&&t.push({name:"type",op:"",value:X[d].toString()}),q.value=z(t),await St(),W()}),{addToTags:j}=Xt(v,u,V),{removeFromTags:O}=Yt(v,u,V),{deleteItems:P}=ut(At,()=>{M()},u),H=[{text:_("add_to_tags"),click:j},{text:_("remove_from_tags"),click:O},{text:_("delete"),click:P}],{selectAll:T,toggleSelect:I}=rt(u),{loading:J,load:W,refetch:M}=Dt({handle:(t,o)=>{o?Lt(_(o),"error"):t&&(u.value=t.calls.map(w=>({...w,checked:!1})),b.value=t.callCount)},document:qt,variables:()=>({offset:(g.value-1)*y,limit:y,query:q.value}),appApi:!0}),d=D.params.type,X={incoming:1,outgoing:2,missed:3};It(g,t=>{d?k(f,`/calls/${d}?page=${t}&q=${C(i.value)}`):k(f,`/calls?page=${t}&q=${C(i.value)}`)});function U(){const t=[];for(const o of c.tags)t.push({name:"tag",op:"",value:ht.kebabCase(o.name)});c.text&&t.push({name:"text",op:"",value:c.text}),i.value=z(t),x()}function x(){d?k(f,`/calls/${d}?q=${C(i.value)}`):k(f,`/calls?q=${C(i.value)}`)}Mt(()=>{Ut.on("refetch_by_tag_type",t=>{t===v&&M()})});function Y(t){if(!t)return"";const o=[];return t.isp&&o.push(_("phone_isp_type."+t.isp)),t.city===t.province?o.push(t.city):o.push(`${t.province}${t.city}`),o.join(", ")}const B=m(""),{mutate:Z,loading:tt}=xt({document:Bt,appApi:!0});function et(t){B.value=t.id,Z({number:t.number})}function st(t){Ot(Jt,{id:t.id,name:t.id,gql:Pt`
      mutation DeleteCall($id: ID!) {
        deleteCalls(ids: [$id])
      }
    `,appApi:!0,typeName:"Call"})}return(t,o)=>{const w=gt,ot=vt,at=ft,lt=dt,nt=_t,ct=mt,it=pt;return n(),r(A,null,[e("div",Zt,[h(w,{current:()=>`${t.$t("page_title.calls")} (${b.value})`},null,8,["current"]),e("div",te,[h(ot,{title:t.$t("actions"),items:H},null,8,["title"]),h(lt,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=s=>i.value=s),search:x},{filters:Qt(()=>[e("div",ee,[e("label",se,a(t.$t("keywords")),1),e("div",oe,[S(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>c.text=s),class:"form-control",onKeyup:Nt(U,["enter"])},null,40,ae),[[Gt,c.text]])])]),e("div",le,[e("label",ne,a(t.$t("tags")),1),e("div",ce,[h(at,{modelValue:c.tags,"onUpdate:modelValue":o[1]||(o[1]=s=>c.tags=s),label:"name","track-by":"id",options:l(V)},null,8,["modelValue","options"])])]),e("div",ie,[e("button",{type:"button",class:"btn",onClick:$(U,["stop"])},a(t.$t("search")),9,ue)])]),_:1},8,["modelValue"])])]),e("table",re,[e("thead",null,[e("tr",null,[e("th",null,[S(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...s)=>l(I)&&l(I)(...s)),"onUpdate:modelValue":o[4]||(o[4]=s=>Rt(T)?T.value=s:null)},null,544),[[N,l(T)]])]),de,e("th",null,a(t.$t("name")),1),e("th",null,a(t.$t("phone_number")),1),e("th",null,a(t.$t("phone_geo")),1),e("th",null,a(t.$t("duration")),1),e("th",null,a(t.$t("type")),1),e("th",null,a(t.$t("tags")),1),e("th",null,a(t.$t("started_at")),1),e("th",pe,a(t.$t("actions")),1)])]),e("tbody",null,[(n(!0),r(A,null,R(u.value,s=>(n(),r("tr",{key:s.id,class:Ft({checked:s.checked}),onClick:$(p=>s.checked=!s.checked,["stop"])},[e("td",null,[S(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":p=>s.checked=p},null,8,_e),[[N,s.checked]])]),e("td",null,[h(nt,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",null,a(s.name),1),e("td",null,[Kt(a(s.number)+" ",1),l(tt)&&B.value===s.id?(n(),r("i",he)):(n(),F(ct,{key:1,class:"bi bi-btn",onClick:$(p=>et(s),["stop"])},null,8,["onClick"]))]),e("td",null,a(Y(s.geo)),1),e("td",null,a(l(zt)(s.duration)),1),e("td",fe,a(t.$t("call_type."+s.type)),1),e("td",null,[(n(!0),r(A,null,R(s.tags,p=>(n(),r("span",ve,a(p.name),1))),256))]),e("td",{class:"nowrap",title:l(Et)(s.startedAt)},a(l(jt)(s.startedAt)),9,ge),e("td",ye,[e("a",{href:"#",class:"v-link",onClick:$(p=>st(s),["stop"])},a(t.$t("delete")),9,be)])],10,me))),128))]),u.value.length?K("",!0):(n(),r("tfoot",$e,[e("tr",null,[e("td",ke,[e("div",Ce,a(t.$t(l(Ht)(l(J),l(E).permissions,"READ_CALL_LOG"))),1)])])]))]),b.value>y?(n(),F(it,{key:0,modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=s=>g.value=s),total:b.value,limit:y},null,8,["modelValue","total"])):K("",!0)],64)}}});export{Ne as default};
