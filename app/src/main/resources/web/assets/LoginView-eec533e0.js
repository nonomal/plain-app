import{d as K,r as A,u as q,a0 as J,c4 as z,c5 as G,c6 as Q,c7 as X,c8 as Y,c9 as Z,ca as ee,m as x,o as L,c as j,b as l,e as se,f as b,J as h,a2 as y,w as ne,g as f,N as oe,K as te,j as ie,k as re,F as ae,cb as ce,cc as de,cd as le,_ as ue}from"./index-79f9263f.js";import{u as me,a as fe}from"./vee-validate.esm-496cb60b.js";function N(s){let n=s;if(typeof n>"u"){if(typeof navigator>"u"||!navigator)return"";n=navigator.userAgent||""}return n.toLowerCase()}function R(s,n){try{return new RegExp(s,"g").exec(n)}catch{return null}}function C(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const n=navigator.userAgentData.brands;return!!(n&&n.length)}function we(s,n){const o=R(`(${s})((?:\\/|\\s|:)([0-9|\\.|_]+))`,n);return o?o[3]:""}function E(s){return s.replace(/_/g,".")}function V(s,n){let o=null,e="-1";return s.some(i=>{const c=R(`(${i.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,n);return!c||i.brand?!1:(o=i,e=c[3]||"-1",i.versionAlias?e=i.versionAlias:i.versionTest&&(e=we(i.versionTest.toLowerCase(),n)||e),e=E(e),!0)}),{preset:o,version:e}}function _(s,n){const o={brand:"",version:"-1"};return s.some(e=>{const i=M(n,e);return i?(o.brand=e.id,o.version=e.versionAlias||i.version,o.version!=="-1"):!1}),o}function M(s,n){return s.find(o=>R(`${n.test}`,o.brand.toLowerCase()))}const T=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],W=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],B=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],F=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],O=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function U(s){return!!V(F,s).preset}function ve(s){const n=N(s),o=!!/mobi/g.exec(n),e={name:"unknown",version:"-1",majorVersion:-1,webview:U(n),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},i={name:"unknown",version:"-1",majorVersion:-1},{preset:c,version:d}=V(T,n),{preset:t,version:a}=V(O,n),m=V(W,n);if(e.chromium=!!m.preset,e.chromiumVersion=m.version,!e.chromium){const w=V(B,n);e.webkit=!!w.preset,e.webkitVersion=w.version}return t&&(i.name=t.id,i.version=a,i.majorVersion=parseInt(a,10)),c&&(e.name=c.id,e.version=d,e.webview&&i.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:i,isMobile:o,isHints:!1}}function D(s){const n=navigator.userAgentData,o=[...n.brands],e=s&&s.fullVersionList,i=n.mobile||!1,c=o[0],d=(s&&s.platform||n.platform||navigator.platform).toLowerCase(),t={name:c.brand,version:c.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!_(F,o).brand||U(N())},a={name:"unknown",version:"-1",majorVersion:-1};t.webkit=!t.chromium&&B.some(r=>M(o,r));const m=_(W,o);if(t.chromium=!!m.brand,t.chromiumVersion=m.version,!t.chromium){const r=_(B,o);t.webkit=!!r.brand,t.webkitVersion=r.version}const w=O.find(r=>new RegExp(`${r.test}`,"g").exec(d));if(a.name=w?w.id:"",s&&(a.version=s.platformVersion),e&&e.length){const r=_(T,e);t.name=r.brand||t.name,t.version=r.version||t.version}else{const r=_(T,o);t.name=r.brand||t.name,t.version=r.brand&&s?s.uaFullVersion:r.version}return t.webkit&&(a.name=i?"ios":"mac"),a.name==="ios"&&t.webview&&(t.version="-1"),a.version=E(a.version),t.version=E(t.version),a.majorVersion=parseInt(a.version,10),t.majorVersion=parseInt(t.version,10),{browser:t,os:a,isMobile:i,isHints:!0}}async function be(){if(C()){const s=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return D(s)}return pe()}function pe(s){return typeof s>"u"&&C()?D():ve(s)}const ge={class:"header"},he={class:"logo"},_e={class:"login-block"},Ve=["placeholder"],ke={class:"d-grid mt-4"},ye=["disabled"],Se={class:"d-grid mt-4"},Ae={key:0,class:"tips"},Ee=K({__name:"LoginView",setup(s){const{handleSubmit:n,isSubmitting:o}=me(),e=A(!1),i=A(!1),c=A("");let d;const t=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:a}=q(),{value:m,errorMessage:w}=fe("password",J().required().min(6));function r(){fetch(`${ce()}/init`,{method:"POST",headers:de()})}r();const $=n(async()=>{r();const v=localStorage.getItem("client_id");d=new WebSocket(`${z()}?cid=${v}&auth=1`);const p=m.value??"",k=G(p),g=Q(k);c.value="",e.value=!1,d.onopen=async()=>{o.value=!0;const u=await be(),S=X(g,JSON.stringify({password:k,browserName:u.browser.name,browserVersion:u.browser.version,osName:u.os.name,osVersion:u.os.version,isMobile:u.isMobile}));d.send(Y(S))},d.onmessage=async u=>{var P;const S=Z(g,ee(await u.data.arrayBuffer())),I=JSON.parse(S);I.status==="PENDING"?i.value=!0:(localStorage.setItem("auth_token",I.token),d.close(),x.push({path:((P=x.currentRoute.value.query.redirect)==null?void 0:P.toString())??"/",replace:!0}))},d.onclose=u=>{u.reason==="abort"||u.reason==="OK"||(o.value=!1,e.value=!0,i.value=!1,c.value=`login.${u.reason?u.reason:"failed"}`)},window.setTimeout(function(){d.readyState!==1&&d.close(3001,"timeout")},2e3)});function H(){i.value=!1,e.value=!1,o.value=!1,d.close(3001,"abort")}return(v,p)=>{const k=le;return L(),j(ae,null,[l("div",ge,[se(k,{"logged-in":!1})]),l("div",he,[l("div",null,b(v.$t("app_name")),1)]),l("div",_e,[h(l("form",{onSubmit:p[1]||(p[1]=ne((...g)=>f($)&&f($)(...g),["prevent"]))},[h(l("div",{class:"alert alert-danger",role:"alert"},b(c.value?v.$t(c.value):""),513),[[y,e.value]]),h(l("input",{type:"password",class:"form-control","onUpdate:modelValue":p[0]||(p[0]=g=>oe(m)?m.value=g:null),placeholder:f(a)("password")},null,8,Ve),[[te,f(m)]]),h(l("div",{class:"invalid-feedback"},b(f(w)?v.$t(f(w),{min:6}):""),513),[[y,f(w)]]),l("div",ke,[l("button",{class:"btn",type:"submit",disabled:f(o)},b(v.$t(f(o)?"logging_in":"log_in")),9,ye)])],544),[[y,!i.value]]),h(l("div",null,[ie(b(v.$t("login.to_continue"))+" ",1),l("div",Se,[l("button",{onClick:H,class:"btn",type:"button"},b(v.$t("cancel")),1)])],512),[[y,i.value]])]),f(t)?(L(),j("div",Ae,b(v.$t("browser_warning")),1)):re("",!0)],64)}}});const Re=ue(Ee,[["__scopeId","data-v-94043886"]]);export{Re as default};
